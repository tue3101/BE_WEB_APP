<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.backendplantshop.mapper.DiscountMapper">
    <resultMap id="DiscountResultMap" type="com.example.backendplantshop.entity.Discounts">
        <id column="discount_id" property="discount_id"/>
        <result column="discount_code" property="discount_code"/>
        <result column="discount_name" property="discount_name"/>
        <result column="value" property="value"/>
        <result column="type" property="type" javaType="com.example.backendplantshop.enums.DiscountType"/>
        <result column="quantity" property="quantity"/>
        <result column="updated_at" property="updated_at"/>
        <result column="created_at" property="created_at"/>
        <result column="is_deleted" property="is_deleted"/>
    </resultMap>
    <!-- Các phần tử SQL-->

    <select id="findById" resultMap="DiscountResultMap" parameterType="integer">
        SELECT *
        FROM discounts
        WHERE discount_id = #{discountID}
        AND is_deleted = false
    </select>

    <select id="getAll" resultMap="DiscountResultMap">
        SELECT *
        FROM discounts
        WHERE is_deleted = false
    </select>

    <insert id="insert">
        INSERT INTO discounts(
                             discount_code
                            ,discount_name
                            , value
                            , type
                            , quantity
        )
        VALUES (
                   #{discount_code}
                   , #{discount_name}
                   , #{value}
                   , #{type}
                   , #{quantity}
               )
    </insert>
    <update id="update" parameterType="Discounts">
        UPDATE discounts
        SET discount_code = #{discount_code}
            ,discount_name = #{discount_name}
            ,value = #{value}
            ,type = #{type}
            ,quantity = #{quantity}
          , is_deleted = #{is_deleted}
        WHERE discount_id = #{discount_id}
    </update>
    <delete id="delete" parameterType="int">
        UPDATE discounts
        SET is_deleted = 1
        WHERE discount_id = #{discountID}
    </delete>



    <select id="findByDiscountCodeOrName" resultMap="DiscountResultMap">
        SELECT discount_id
            ,discount_code
             ,discount_name
             ,value
             ,type
             ,quantity
            ,updated_at
            ,created_at

        FROM discounts
        WHERE discount_code = #{discountCode}
        OR discount_name = #{discountName}
        AND is_deleted = false
        LIMIT 1
    </select>



    <select id="findByIdDeleted" resultMap="DiscountResultMap" parameterType="integer">
        SELECT *
        FROM discounts
        WHERE discount_id = #{discountID}
          AND is_deleted = true
    </select>
    <update id="restoreDiscount" parameterType="int">
        UPDATE discounts
        SET is_deleted = 0,
            updated_at = CURRENT_TIMESTAMP
        WHERE discount_id = #{discountID}
    </update>
</mapper>